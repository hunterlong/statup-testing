language: node_js
node_js:
  - 10
env:
  global:
     - CYPRESS_DB_HOST=0.0.0.0
     - CYPRESS_DB_USER=travis
     - CYPRESS_DB_PASS=
     - CYPRESS_DB_DATABASE=test
     - CYPRESS_DB_PORT=5432
     - VERSION=0.29.1

sudo: required
services:
  - docker
  - postgresql
  - mysql
cache:
  directories:
    - ~/.npm
    - ~/.cache
install:
  - npm ci
before_script:
  - ifconfig
  - mysql -e 'CREATE DATABASE IF NOT EXISTS test;'
  - psql -c 'create database test;' -U postgres
  - docker pull hunterlong/statup:v$VERSION
script:
  - docker run -it -d -p 8080:8080 --network host hunterlong/statup:v$VERSION
  - sleep 10
  - npm run test